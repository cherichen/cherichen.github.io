var Se=Object.defineProperty,xe=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var Z=(l,e,s)=>e in l?Se(l,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[e]=s,O=(l,e)=>{for(var s in e||(e={}))re.call(e,s)&&Z(l,s,e[s]);if(W)for(var s of W(e))ie.call(e,s)&&Z(l,s,e[s]);return l},T=(l,e)=>xe(l,Ce(e));var X=(l,e)=>{var s={};for(var t in l)re.call(l,t)&&e.indexOf(t)<0&&(s[t]=l[t]);if(l!=null&&W)for(var t of W(l))e.indexOf(t)<0&&ie.call(l,t)&&(s[t]=l[t]);return s};var P=(l,e,s)=>(Z(l,typeof e!="symbol"?e+"":e,s),s);import{v as De,r as ke,c as Ne,o as Re,a as V,b as d,w as ce,t as _,d as S,e as E,f as q,m as G,l as Me,T as le,g as ue,h as J,i as de,j as he,u as pe,k as Q,n as $,p as je,q as fe,s as ve,x as Oe,y as ee,F as Pe,z as Be,A as Ee,B as Ae,C as Te}from"./vendor.13713dd4.js";const _e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}};_e();function He(l={}){const{immediate:e=!1,onNeedRefresh:s,onOfflineReady:t,onRegistered:r,onRegisterError:a}=l;let o;const h=async(i=!0)=>{};return"serviceWorker"in navigator&&(o=new De("/sw.js",{scope:"/",type:"classic"}),o.addEventListener("activated",i=>{i.isUpdate?window.location.reload():t==null||t()}),o.register({immediate:e}).then(i=>{r==null||r(i)}).catch(i=>{a==null||a(i)})),h}var Ve=(l,e)=>{const s=l.__vccOpts||l;for(const[t,r]of e)s[t]=r;return s};const qe={};function Ke(l,e){const s=ke("router-view");return Re(),Ne(s)}var $e=Ve(qe,[["render",Ke]]);class ze{constructor(e){P(this,"idbDataBase",null);P(this,"transaction",null);P(this,"request",null);P(this,"runner",[]);P(this,"storeList",[]);P(this,"finish",null);P(this,"libName","");P(this,"operateLib",null);this.init(e)}init(a){var o=a,{dbName:e="waterMelon",dbVersion:s="1",storeList:t=[]}=o,r=X(o,["dbName","dbVersion","storeList"]);this.dbName=e,this.idbDataBase&&this.idbDataBase.close(),this.finish=new Promise((h,i)=>{const I=p=>{const f=p.target.result;this.idbDataBase=f,this.dbVersion=f.version,this.idbObjectStoreNames=f.objectStoreNames,window.dataBase=f,this.transaction=this.idbDataBase.transaction.bind(this.idbDataBase),h(f)},N=p=>{I(p);const f=[];t.forEach(F=>{var L=F,{index:c}=L,y=X(L,["index"]);let u=null;f.push(y.storeName),this.idbObjectStoreNames.contains(y.storeName)?u=this.request.transaction.objectStore(y.storeName):u=this.idbDataBase.createObjectStore(y.storeName,O({keyPath:"id",autoIncrement:!0},y)),[...u.indexNames].forEach(j=>u.deleteIndex(j)),c.forEach(j=>{let[v,k="false"]=j.split(":");v=v.trim(),k=k.trim(),u.createIndex(v,v,{unique:k!=="false"})})}),[...this.idbDataBase.objectStoreNames].forEach(c=>{f.includes(c)||this.idbDataBase.deleteObjectStore(c)})},b=indexedDB.open(e,s);b.onupgradeneeded=p=>N(p),b.onsuccess=p=>I(p),b.onerror=i,this.request=b})}close(){this.idbDataBase&&this.idbDataBase.close()}getLib(e){const s=Object.create(this);return s.libName=e,s}dealRequest(e,...s){return new Promise((t,r)=>{this.finish.then(()=>{const o=this.transaction(this.libName,"readwrite").objectStore(this.libName)[e](...s);if(o.toString()==="[object IDBIndex]"){t(o);return}o.onsuccess=h=>t(h.target.result),o.onerror=r})})}get(e){return this.dealRequest("get",e)}getAll(e){return this.dealRequest("getAll",e)}add(e){return this.dealRequest("add",T(O({},e),{create:Date.now()}))}async update(e){const s=await this.get(e.id);return this.dealRequest("put",T(O(O({},s),e),{update:Date.now()}))}delete(e){return this.dealRequest("delete",e)}find(e,s="content"){return new Promise(async(t,r)=>{const a=[],o=await this.dealRequest("index",s);if(!e){o.getAll().onsuccess=i=>t(i.target.result);return}const h=IDBKeyRange.only(e);o.openCursor(h).onsuccess=i=>{const I=i.target.result;if(!I)return t(a);a.push(I.value),I.continue()}})}query(e,s="content"){return new Promise(async(t,r)=>{try{const a=await this.dealRequest("index",s);a.getAll().onsuccess=o=>{const h=o.target.result;if(!e)return t(h);const i=e.split(" ").filter(N=>N),I=h.filter(N=>{const b=N[s]+"";for(let m=0;m<i.length;m++)if(!b.includes(i[m]))return!1;let p=new RegExp(`(.{0,10})(${i.reverse().join("|")})(.{0,10})`,"g");const f=b.replace(p,'$%$1<span class="searchHight">$2</span>$3%$').match(/(?<=\$%)(.*?)(?=%\$)/g,"$1");return N.__searchResult=f,!0});t(I)}}catch(a){console.error(a),t([])}})}}const te=["create","update"],Ue={storeName:"atom",index:[...te,"title:false","content","describe","type","area","target","tag","history","extra"]},We={storeName:"relation",index:[...te,"childId","parentId","relation","target","area"]},Xe={storeName:"tag",index:[...te,"atomId","title","content","describe","color","type","target"]},Je={dbName:"waterMelon",dbVersion:4,storeList:[Ue,We,Xe]};var ge=new ze(Je);class Ye{constructor(){P(this,"_finish",null);P(this,"dbList",["atom","tag","relation"]);P(this,"data",V({atom:[],tag:[],relation:[],currentItem:{}}));P(this,"dbItem",{atom:null,tag:null,relation:null});this.initDb(),this._finish=this.init()}async initDb(){for(let e in this.dbItem)this.dbItem[e]=await ge.getLib(e)}async init(e="atom"){if(e){const t=await ge.getLib(e).getAll();return this.data[e]=t}const s=await Promise.all(this.dbList.map(t=>this.dbList[t].getAll()));return this.dbList.forEach((t,r)=>this.data[t]=s[r]),s}async atomFetch(e,...s){const t=await this.dbItem.atom[e](...s);return await this.init("atom"),t}async tagFetch(e,...s){const t=await this.dbItem.tag[e](...s);return await this.init("tag"),t}async relationFetch(e,...s){const t=await this.dbItem.relation[e](...s);return await this.init("relation"),t}changeData(e,s){this.data[e]&&(this.data[e]=s)}}const me=new Ye;window.libFetch=me;var Ze={emits:["mousedownFnc"],setup(l,{emit:e,slots:s}){const t=r=>e("mousedownFnc",r);return()=>d("div",{class:"dragPanel",onSelect:()=>!1,onMousedown:ce(t,["self"])},[s.default&&s.default()])}},Ie={props:{area:Object,layer:Number,fullScreen:{type:Boolean,default:!1}},emits:["downFnc","upFnc","moveFnc","changeTile"],setup(l,{slots:e,attrs:s,emit:t,expose:r}){const{area:a,layer:o,fullScreen:h}=_(l),i=V({top:0,left:0,width:0,height:0,zIndex:0});o.value=o.value||0;const I=(v,k)=>{const R=0,C=10,M=window.innerWidth-i.width,z=window.innerHeight-i.height||C;i.left=Math.max(R,Math.min(M,v)),i.top=Math.min(z,Math.max(C,k))},N=()=>{var v,k,R,C,M;i.width=((v=a.value)==null?void 0:v.width)||0,i.height=((k=a.value)==null?void 0:k.height)||0,i.zIndex=((R=a.value)==null?void 0:R.zIndex)||o.value,I(((C=a.value)==null?void 0:C.left)||0,Math.max(((M=a.value)==null?void 0:M.top)||0,14))};N();const b=S(!1);b.value=h.value;const p=S(!1),f=S(null),m=S(null),c=S(0),y=S(0),F=()=>{if(o.value<i.zIndex)return;const v=o.value+1;i.zIndex=v,t("changeTile",i)},L=(v,k)=>{if(b.value){b.value=!1,p.value=!1;return}if(p.value=!0,!f.value)return;const{left:R,top:C}=f.value.getBoundingClientRect();c.value=v.clientX-R,y.value=v.clientY-C,F(),t("downFnc",v)},u=v=>p.value=!1,x=v=>{if(!p.value)return;let k=v.clientX-c.value,R=v.clientY-y.value;I(k,R)},j=v=>b.value=!b.value;return E(i,v=>{b.value||t("changeTile",v)},{deep:!0}),E(()=>a.value,N,{deep:!0}),q(()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",u),document.addEventListener("mousemove",x),document.addEventListener("mouseup",u),new ResizeObserver(k=>{let{width:R,height:C}=k[0].contentRect;i.width=R,i.height=C}).observe(m.value)}),r({changeScreen:j}),()=>d("div",{ref:f,style:{left:i.left+"px",top:i.top+"px","z-index":i.zIndex},class:{tile:!0,fullScreen:!!b.value}},[d(Ze,{onMousedownFnc:L},{default:()=>[e.dragHeader&&e.dragHeader(i,{upperLayer:F,changeScreen:j,isFull:b,isHandler:p})]}),e.header&&e.header(i),d("div",{ref:m},[e.default&&e.default(i,{upperLayer:F,isFull:b,isHandler:p})]),e.footer&&e.footer(i,{upperLayer:F})])}};G.setOptions({gfm:!0,tables:!0,breaks:!0,katex:!1,headerIds:!0,headerPrefix:"",highlight:function(l,e){const s=e?[e]:null;return Me.highlightAuto(l,s).value}});const we=new le({headingStyle:"atx",codeBlockStyle:"fenced",bulletListMarker:"-",fence:"```",preformattedCode:!0});le.prototype.escape=l=>[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^\+ /g,"\\+ "],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/^_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]].reduce((s,t)=>s.replace(t[0],t[1]),l);const be=we.turndown.bind(we),Ge=l=>{const e=l.clipboardData.getData("text/html"),s=l.clipboardData.getData("text/plain"),r=window.getSelection().getRangeAt(0);r.deleteContents(),r.startContainer,r.startOffset;const a=G(be(e||s)),o=document.createElement("div");o.innerHTML=a,r.insertNode(o)};var Qe={props:{content:String,viewSeat:Object,isFocus:{type:Boolean,default:!1},editAble:{type:Boolean,default:!1}},emits:["blurfnc","update:content"],setup(l,e){const{content:s,viewSeat:t,editAble:r,isFocus:a}=_(l),{emit:o}=e,h=S("view"),i=()=>{h.value&&o("blurfnc",h.value.innerHTML||"","view")},I=()=>{!h.value||(t.value.width&&(h.value.style.width=t.value.width+"px"),t.value.height&&(h.value.style.height=t.value.height+"px"))};return q(()=>{!h.value||(I(),a.value&&h.value.focus())}),ue(i),()=>d("div",{ref:h,class:"view",contentEditable:r.value,innerHTML:s.value,onBlur:i,onSelect:()=>!1,onPaste:ce(Ge,["stop","prevent"])},null)}};var ae={props:{type:{type:String,default:"atom"}},emits:["insert"],setup(l,{slots:e,emit:s}){const{type:t}=_(l),a=J().appContext.config.globalProperties.$libFetch,o=S(null),h=S(""),i=S(""),I=S([]),N=(p,f)=>{h.value="",s("insert",f.id-0)},b=async p=>{if(!p.code==="Enter"||!p.altKey)return;const m=h.value.trim(),c=t.value,y=await a[c+"Fetch"]("add",{content:m,title:m});s("insert",y-0),h.value=""};return E(()=>h.value,async p=>{const f={t:"title",c:"content",d:"describe"};let[m="",c="content",y=t.value]=p.trim().split("|");if(m=m.trim(),c=c.trim(),c=f[c]||c,i.value=m,!m)return I.value=[];if(m.startsWith("#")){m=m.slice(1);const F=await a[y+"Fetch"]("get",m-0);I.value=F?[F]:[];return}I.value=await a[y+"Fetch"]("query",m,c)||[]}),()=>d("span",{style:"position: relative;"},[d("span",null,[e.default&&e.default()]),de(d("input",{ref:o,type:"text",class:"suggestIcon","onUpdate:modelValue":p=>h.value=p,onKeyup:b},null),[[he,h.value]]),d("div",{class:"suggestResult"},[I.value.map(p=>d("div",{class:"resultItem",onClick:f=>N(f,p)},[d("div",{class:"title"},[p.content])]))])])}};function ne(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!je(l)}var et={props:["itemInfo","isShow","pageItem"],setup(l){const e=pe(),t=J().appContext.config.globalProperties.$libFetch,{itemInfo:r,pageItem:a}=_(l),o=V({parentIds:[],childIds:[],tagList:[],parentIdMap:{},childIdMap:{}}),h=Q("insertCard"),i=Q("refreshHash"),I=Q("refreshFnc"),N=async y=>t.atomFetch("get",y),b=()=>{o.parentIds=[],o.childIds=[],o.tagList=[],o.parentIdMap={},o.childIdMap={}},p=async()=>{if(!r.value.id)return;await t._finish,b();const[y,F,L]=await Promise.all([t.relationFetch("find",r.value.id,"parentId"),t.relationFetch("find",r.value.id,"childId"),t.tagFetch("getAll")]);L.forEach(u=>{u.atomId&&u.atomId.includes(r.value.id)&&o.tagList.push(u)}),F.forEach(async u=>{const x=u.parentId,j=await N(x);o.parentIdMap[u.parentId]=u.id,o.parentIds.push({id:x,item:u,atom:j})}),y.map(async u=>{const x=u.childId;o[u.childId]=u.id;const j=await N(x);o.childIds.push({id:x,item:u,atom:j})})},f=async(y,F,L)=>{if(r.value.id===y)return;const u=L==="parentId"?"childId":"parentId";o[L+"Map"][y]||(await t[F]("add",{[u]:r.value.id,[L]:y}),I())},m=async y=>{const F=await t.tagFetch("get",y),L=r.value.id,u=F.atomId||[];u.includes(L)||(u.push(L),await t.tagFetch("update",T(O({},F),{atomId:u})),I())},c=async(y,F,L="relation")=>{const u=L==="relation";if(y.ctrlKey){let x;if(u)x=F.item.id,await t[L+"Fetch"]("delete",x);else{x=F.id;const v=(F.atomId||[]).filter(k=>k!==r.value.id);await t[L+"Fetch"]("update",{id:x,atomId:v})}return I()}if(y.altKey)return e.push({name:u?"ov":"tag",params:{id:F.id}});h(F.atom)};return q(p),E(()=>i.value,p),E(()=>r.value.id,p),()=>{let y,F,L;return d("div",{class:"infoPanel"},[d("div",{class:"parent infoItem"},[d("span",{class:"icon"},[$("/")]),d(ae,{onInsert:u=>f(u,"relationFetch","parentId")},ne(y=o.parentIds.map(u=>d("span",{class:{link:!0,current:u.id===a.value.id},title:u.atom.title||u.atom.content,onClick:x=>c(x,u)},[u.id])))?y:{default:()=>[y]})]),d("div",{class:"child infoItem"},[d("span",{class:"icon"},[$("/")]),d(ae,{onInsert:u=>f(u,"relationFetch","childId")},ne(F=o.childIds.map(u=>d("span",{class:{link:!0,current:u.id===a.value.id},title:u.atom.title||u.atom.content,onClick:x=>c(x,u)},[u.id])))?F:{default:()=>[F]})]),d("div",{class:"tag infoItem"},[d("span",{class:"icon"},[$("/")]),d(ae,{onInsert:m,type:"tag"},ne(L=o.tagList.map(u=>d("span",{class:{link:!0},title:u.content||u.content,style:{color:u.color||""},onClick:x=>c(x,u,"tag")},[u.content||u.id])))?L:{default:()=>[L]})])])}}};const tt={theme:"vs-dark",roundedSelection:!0,automaticLayout:!0,autoDetectHighContrast:!0,contextmenu:!0,lineNumbers:!1,droppable:!0,fontSize:15,fontFamily:'consolas, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif',format:!0,formatOnType:!0,formatOnPaste:!0,autoIndent:!0,folding:!0,wordWrap:!0,language:"markdown",charset:"UTF-8",unicodeHighlight:{ambiguousCharacters:!1},minimap:{enabled:!1}};class at{constructor(e,{blur:s}){P(this,"monaco",null);const t=fe.create(e,tt);return t.editor=fe,t.onDidBlurEditorWidget(s),t}}var nt={props:{content:String,viewSeat:Object},emits:["blurfnc","update:content"],setup(l,e){const{content:s,viewSeat:t}=_(l),{emit:r}=e,a=S("editor");let o=null;const h=()=>{if(!!o)return o.getValue()||""},i=()=>r("blurfnc",h(),"editor"),I=()=>{a.value.style.width=t.value.width+"px",a.value.style.height=t.value.height+"px"};return q(()=>{I(),o=new at(a.value,{blur:i}),o.setValue(s.value),o.focus()}),ue(i),()=>d("div",{class:"editor",ref:a},null)}},st={props:["itemInfo","itemIndex","layer","viewModel","isFocus","isActive","pageItem"],emits:["deleteItem","add","changeLayer","changeCurrent","changePage","hide"],setup(l,{attrs:e,slots:s,emit:t,expose:r}){const a=S(null),{itemInfo:o,itemIndex:h,layer:i,viewModel:I,isFocus:N,isActive:b,pageItem:p}=_(l),f=S(""),m=S(!1);m.value=N.value,f.value=o.value.content||"";const c=S(!0);c.value=I.value;const y=S({}),F=ve(()=>G(f.value)),L=ve(()=>f.value),u=v=>{y.value=v,t("changeLayer",{area:v,content:f.value},h.value)},x=(v="",k,R)=>{let C=k==="view"?be(v):v;if(C=C.replace(/[-]\s{2,}/g,"- "),C=C.trim(),!f.value&&!C&&!o.value.id){if(R)return;t("deleteItem",h.value)}f.value=C},j=v=>a.value&&a.value.changeScreen(v);return E(()=>f.value,v=>{t("add",{content:v,area:O({},y.value)},h.value)}),r({triggleView:v=>{c.value=!c.value,m.value=!0},changeScreen:j,isView:c}),()=>d(Ie,{ref:a,area:o.value.area,layer:i.value,class:T(O({},o.value.options),{active:b.value}),onMousedown:v=>t("changeCurrent",h.value),onChangeTile:u},{dragHeader:(v,{changeScreen:k})=>{var R,C;return d("span",{class:"toolPanel"},[d("span",{class:"tool hide",title:"Hide It",onClick:M=>t("hide",h.value,"hide")},null),!((C=(R=o.value)==null?void 0:R.options)==null?void 0:C.searchLink)&&d("span",{class:"tool pin",title:"Pin Up",onClick:M=>t("hide",h.value,"pin")},null)])},default:(v,{upperLayer:k,isFull:R,isHandler:C})=>d("div",{style:"positon: relative;"},[d("span",{class:{cardBefore:!0,active:b.value},onClick:M=>t("changePage",h.value)},[o.value.id]),c.value?d(Qe,{class:{fullScreen:R.value},content:F.value,"onUpdate:content":M=>F.value=M,viewSeat:v,isFocus:m.value,onBlurfnc:(...M)=>x(...M,C.value),onMousedown:k,editAble:!0},null):d(nt,{class:{fullScreen:R.value},content:L.value,"onUpdate:content":M=>L.value=M,viewSeat:v,onMousedown:k,editAble:!0,onBlurfnc:(...M)=>x(...M,C.value)},null)]),footer:v=>d(et,{itemInfo:o,pageItem:p.value},null)})}};var ot={name:"Search",props:["area","isShow"],setup(l,{emit:e}){const t=J().appContext.config.globalProperties.$libFetch,r=t.data;window.libData=r;const{isShow:a,area:o}=_(l),h=S(""),i=S(null),I=S([]),N=async(b,{self:p,current:f})=>{if(p||f)return;const m=await t.atomFetch("get",b);m&&e("insertFnc",m),h.value="",a.value=!1};return q(()=>{document.addEventListener("keydown",b=>{b.code==="Escape"&&a.value&&(h.value="",a.value=!1)})}),E(()=>a.value,b=>{b&&setTimeout(()=>{i.value.focus()},50)}),E(()=>h.value,async b=>{const p={t:"title",c:"content",d:"describe"};let[f="",m="content",c="atom"]=b.trim().split("|");if(f=f.trim(),m=m.trim(),m=p[m]||m,!f)return I.value=[];I.value=await t[c+"Fetch"]("query",f,m)||[],console.dir(f),console.dir(m),console.dir(I.value),console.dir("--------------------")}),()=>d(Ie,{style:{display:a.value?"block":"none"},area:o.value},{default:b=>d("div",{class:"searchPanel"},[de(d("input",{ref:i,type:"text",class:"searchIcon","onUpdate:modelValue":p=>h.value=p},null),[[he,h.value]]),d("div",{class:"searchResult"},[I.value.map(p=>{const f=p.id===r.currentItem.id,m=p.parentIds&&p.parentIds.includes(`%${r.currentItem.id}$`);return d("div",{class:"searchItem",onClick:()=>N(p.id,{self:f,current:m})},[d("div",{class:"itemHeader"},[d("div",{class:{light:!0,current:m,self:f}},[$("\xA0")]),d("div",null,[d("div",null,[p.title||p.content.substr(0,18)])])])])})])])})}};var rt={props:["menuList","activeIndex"],emits:["showCard"],setup(l,{emit:e}){const{menuList:s,activeIndex:t}=_(l),r=a=>{};return()=>d("div",{class:"menuPanel"},[d("div",{class:"parent",onClick:r},[d("span",null,[$("...")])]),s.value.map((a,o)=>{var h;return d("div",{onClick:i=>e("showCard",o),class:{searchLink:!!((h=a==null?void 0:a.options)==null?void 0:h.searchLink),active:t.value===o,hide:a.target===".hide"}},[d("span",null,[a.id])])})])}},it={setup(l,e){const s=Oe(),t=pe(),a=J().appContext.config.globalProperties.$libFetch,o=a.data;window.libObj=o;const h=V({}),i=S(0),I=S(-1),N=S(!0),b=S(null),p=S(!1),f=S(""),m=V({left:1e4,top:14,right:0,width:580,height:"auto",zIndex:9999}),c=V({currentItem:{},pageList:[],pageIdsList:{},atomList:[],relationItem:[]});window.pageData=c;const y=async(n,w)=>{const g=o.atom.find(B=>B.title===w);if(g)return g;const D=await a.atomFetch("add",{title:w,type:n,describe:w});return await a.atomFetch("get",D)},F=async n=>{if(await a._finish,n==="root"){const g=await y(".root",n);return c.currentItem=g}if(n-=0,isNaN(n))return;const w=o.atom.find(g=>g.id===n);if(!w)return t.push({name:"ov",params:{id:"root"}});c.currentItem=w},L=n=>{const w=c.pageList[n].id;w&&t.push({name:"ov",params:{id:w}})},u=()=>{c.pageList=c.atomList.filter(({target:n})=>n!==".del"),N.value=!0},x=async()=>{const n=c.currentItem;a.changeData("currentItem",n);const w=[],g=await a.relationFetch("find",n.id,"parentId");await Promise.all(g.map(async({childId:D="",area:H,target:B})=>{const A=await a.atomFetch("get",D);return w.push(T(O({},A),{key:Math.random().toString(16),area:H,target:B,hide:B===".hide"})),A})),c.atomList=w,c.relationItem=g,u()},j=(n,w)=>{const g=c.pageList.push(T(O({key:Math.random().toString(16)},n),{options:w}));I.value=g-1},v=n=>{const w=c.pageIdsList[n.id];if(w){I.value=w.index,c.pageList[w.index].hide=!1;return}j(O({},n),{searchLink:!0})},k=n=>{v(n),p.value=!1},R=(n={})=>p.value=!0,C=n=>{n.target===n.currentTarget&&(!(n.ctrlKey||n.altKey)||(j({area:{left:n.pageX,top:n.pageY}},{isFocus:!0}),N.value=n.ctrlKey))},M=async(n,w)=>{const g=c.currentItem,D=c.pageList[w],A=D,{options:H={}}=A,B=X(A,["options"]);if(B.id){if(await a.atomFetch("update",JSON.parse(JSON.stringify(T(O({},n),{id:B.id})))),!H.searchLink){const K=c.relationItem.find(({childId:U})=>U===B.id);K&&await a.relationFetch("update",JSON.parse(JSON.stringify({id:K.id,area:n.area})))}}else{const K=await a.atomFetch("add",n),U={childId:K,parentId:g.id,area:n.area},Le=await a.relationFetch("add",U);c.pageList[w].id=K,c.relationItem.push(O({id:Le},U))}D.content=n.content||D.content,D.area=n.area||D.area},z=async n=>{await F(n),x()},ye=async({area:n,content:w},g)=>{i.value=n.zIndex,!(!c.pageList[g]||!c.pageList[g].id)&&(await Be(),n.zIndex>1e3,M({area:n,content:w},g))},Y=async(n,w)=>{const g=c.pageList.splice(n,1)[0];if(!(!g||!g.id))if(w)await a.atomFetch("update",{id:g.id,target:".del",delTime:Date.now()});else{await a.atomFetch("delete",g.id);const D=await a.relationFetch("find",g.id,"childId");[...await a.relationFetch("find",g.id,"parentId"),...D].forEach(({id:A})=>a.relationFetch("delete",A))}},oe=async(n,w)=>{var B;const g=c.pageList[n],D=g.target===".hide"?"":".hide";if(w==="hide")return((B=g==null?void 0:g.options)==null?void 0:B.searchLink)&&c.pageList.splice(n,1),g.hide=!0;const H=c.relationItem.find(A=>A.childId===g.id);await a.relationFetch("update",{id:H.id,target:D}),g.target=D,g.hide=D===".hide"},Fe=n=>{const w=c.pageList[n];I.value=n,w.hide=!1};return ee("insertCard",v),ee("refreshHash",f),ee("refreshFnc",()=>f.value=Math.random().toString(16)),q(()=>{z(s.params.id),document.onkeydown=n=>{const w=n.srcElement.localName==="body",g=I.value;if(w)return n.code==="KeyX"?window.close():n.code==="KeyP"?R():void 0;const D=h[g];if(D&&n.altKey&&n.code==="KeyV")return D.triggleView(n);if(D&&n.altKey&&n.code==="KeyZ")return D.changeScreen(n);if(n.altKey&&n.code==="KeyD")return n.preventDefault(),Y(g,30);if(n.altKey&&n.code==="KeyH")return oe(g,"hide");if(n.altKey&&n.code==="Delete")return Y(g)}}),E(()=>s.params.id,n=>n&&z(n)),E(()=>c.pageList.length,n=>{c.pageIdsList=[],c.pageList.forEach((w,g)=>{c.pageIdsList[w.id]=T(O({},w),{index:g}),i.value=Math.max(i.value,n)}),i.value=Math.max(i.value,n)},{deep:!0}),()=>d(Pe,null,[d(rt,{menuList:c.pageList,activeIndex:I.value,onShowCard:Fe},null),d("div",{style:"width: calc(100vw - 15px); height: calc(100vh);",ref:b,onclick:C},[d(ot,{isShow:p,area:m,onInsertFnc:k},null),c.pageList.map((n,w)=>{var g;return!n.hide&&d(st,{key:n.key,ref:D=>h[w]=D,viewModel:N,pageItem:c.currentItem,itemInfo:n,itemIndex:w,layer:i.value,isActive:I.value===w,isFocus:((g=n==null?void 0:n.options)==null?void 0:g.isFocus)||!1,onAdd:M,onChangeLayer:ye,onChangeCurrent:D=>I.value=D,onDeleteItem:Y,onChangePage:L,onHide:oe},null)})])])}};const ct=Ee({history:Ae(),routes:[{name:"ov",path:"/ov/:id",component:it},{path:"/:pathMatch(.*)*",redirect:"/ov/root"}]}),se=Te($e);se.config.globalProperties.$libFetch=me;se.use(ct);se.mount("#app");const lt=He({onNeedRefresh(){},onOfflineReady(){}});lt();
