var ee=Object.defineProperty,te=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var F=(o,e,n)=>e in o?ee(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,N=(o,e)=>{for(var n in e||(e={}))K.call(e,n)&&F(o,n,e[n]);if(k)for(var n of k(e))$.call(e,n)&&F(o,n,e[n]);return o},D=(o,e)=>te(o,ne(e));var T=(o,e)=>{var n={};for(var t in o)K.call(o,t)&&e.indexOf(t)<0&&(n[t]=o[t]);if(o!=null&&k)for(var t of k(o))e.indexOf(t)<0&&$.call(o,t)&&(n[t]=o[t]);return n};var S=(o,e,n)=>(F(o,typeof e!="symbol"?e+"":e,n),n);import{r as V,a as ae,c as oe,o as re,m as z,T as se,t as _,b as h,d as j,e as W,f as p,w as le,M as ie,g as ce,h as ue,i as X,j as A,k as de,l as ve,n as fe,p as pe,q as he,s as me}from"./vendor.eb20da0e.js";const ge=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}};ge();const be={setup(o){return V([{id:1,children:[2,3,4,5]},{id:2,children:[4,5]},{id:3,children:[1,2,5]},{id:4,children:[]}]),(n,t)=>{const a=ae("router-view");return re(),oe(a)}}};class we{constructor(e){S(this,"idbDataBase",null);S(this,"transaction",null);S(this,"request",null);S(this,"runner",[]);S(this,"storeList",[]);S(this,"finish",null);S(this,"libName","");S(this,"operateLib",null);this.init(e)}init(r){var l=r,{dbName:e="fireMelon",dbVersion:n="1",storeList:t=[]}=l,a=T(l,["dbName","dbVersion","storeList"]);this.dbName=e,this.idbDataBase&&this.idbDataBase.close(),this.finish=new Promise((g,f)=>{const d=m=>{const v=m.target.result;this.idbDataBase=v,this.dbVersion=v.version,this.idbObjectStoreNames=v.objectStoreNames,window.dataBase=v,this.transaction=this.idbDataBase.transaction.bind(this.idbDataBase),g(v)},w=m=>{d(m);const v=[];t.forEach(s=>{var y=s,{index:i}=y,u=T(y,["index"]);let I=null;v.push(u.storeName),this.idbObjectStoreNames.contains(u.storeName)?I=this.request.transaction.objectStore(u.storeName):I=this.idbDataBase.createObjectStore(u.storeName,N({keyPath:"id",autoIncrement:!0},u)),[...I.indexNames].forEach(B=>I.deleteIndex(B)),i.forEach(B=>{let[M,E="false"]=B.split(":");M=M.trim(),E=E.trim(),I.createIndex(M,M,{unique:E!=="false"})})}),[...this.idbDataBase.objectStoreNames].forEach(i=>{v.includes(i)||this.idbDataBase.deleteObjectStore(i)})},b=indexedDB.open(e,n);b.onupgradeneeded=m=>w(m),b.onsuccess=m=>d(m),b.onerror=f,this.request=b})}close(){this.idbDataBase&&this.idbDataBase.close()}getLib(e){const n=Object.create(this);return n.libName=e,n}dealRequest(e,...n){return new Promise((t,a)=>{this.finish.then(()=>{const l=this.transaction(this.libName,"readwrite").objectStore(this.libName)[e](...n);l.onsuccess=g=>t(g.target.result),l.onerror=a})})}get(e){return this.dealRequest("get",e)}getAll(e){return this.dealRequest("getAll",e)}add(e){return this.dealRequest("add",D(N({},e),{create:Date.now()}))}async update(e){const n=await this.get(e.id);return this.dealRequest("put",D(N(N({},n),e),{update:Date.now()}))}delete(e){return this.dealRequest("delete",e)}}const O=["create","update"],ye={storeName:"atom",index:[...O,"title","content","sketch","addition","describe","type","target"]},xe={storeName:"paper",index:[...O,"atom","children","parent","type"]},Se={storeName:"tag",index:[...O,"title","content","children"]},Ie={storeName:"decorate",index:[...O,"atom","tag"]},Le={dbName:"waterMelon",dbVersion:13,storeList:[ye,xe,Se,Ie]};var Ne=new we(Le);z.setOptions({gfm:!0,tables:!0,breaks:!0,katex:!1,headerIds:!0,headerPrefix:""});const Y=new se({headingStyle:"atx",codeBlockStyle:"fenced",fence:"```",preformattedCode:!0}),G=Y.turndown.bind(Y),Me=o=>{const e=o.clipboardData.getData("text/html"),n=o.clipboardData.getData("text/plain"),a=window.getSelection().getRangeAt(0);a.deleteContents(),a.startContainer,a.startOffset;const r=z(G(e||n)),l=document.createElement("div");l.innerHTML=r,a.insertNode(l)};var Be={props:{content:String,viewSeat:Object},emits:["blurfnc","update:content"],setup(o,e){const{content:n,viewSeat:t}=_(o),{emit:a}=e,r=h("view"),l=()=>a("blurfnc",r.value.innerHTML||"","view"),g=()=>{r.value.style.width=t.value.width+"px",r.value.style.height=t.value.height+"px"};return j(()=>{g(),r.value.focus()}),W(l),()=>p("div",{ref:r,class:"view",contentEditable:!0,innerHTML:n.value,onBlur:l,onSelect:()=>!1,onPaste:le(Me,["stop","prevent"])},null)}};const De={theme:"vs-dark",roundedSelection:!0,automaticLayout:!0,contextmenu:!0,lineNumbers:!1,droppable:!0,fontSize:15,fontFamily:'consolas, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif',format:!0,formatOnType:!0,formatOnPaste:!0,autoIndent:!0,wordWrap:!0,language:"markdown",minimap:{enabled:!1}},Re=new ie;class Ee{constructor(e,{blur:n}){S(this,"editor",null);const t=ce.create(e,De);return Re.activate(t),t.monaco=ue,t.onDidBlurEditorWidget(n),t}}var ke={props:{content:String,viewSeat:Object},emits:["blurfnc","update:content"],setup(o,e){const{content:n,viewSeat:t}=_(o),{emit:a}=e,r=h("editor");let l=null;const g=()=>{if(!!l)return l.getValue()||""},f=()=>a("blurfnc",g(),"editor"),d=()=>{r.value.style.width=t.value.width+"px",r.value.style.height=t.value.height+"px"};return j(()=>{d(),l=new Ee(r.value,{blur:f}),l.setValue(n.value),l.focus()}),W(f),()=>p("div",{class:"editor",ref:r},null)}},je={emits:["mousefnc"],setup(o,{emit:e,slots:n}){return()=>p("div",{class:"dragPanel",onMousedown:t=>e("mousefnc",t)},[n.default&&n.default("hello world")])}},Oe={props:["itemInfo","itemIndex","layer","viewModel"],emits:["del","add","changeLayer"],setup(o,{attrs:e,slots:n,emit:t}){const{itemInfo:a,itemIndex:r,layer:l,viewModel:g}=_(o),f=h(!1),d=h(!1),w=h(""),b=h(null),m=h(null);w.value=a.value.content||"";const v=h(0),R=h(0),i=h(0),u=h(!0),s=V({top:0,left:0,width:0,height:0});v.value=a.value.zIndex||l.value,s.left=a.value.seat.left,s.top=Math.max(a.value.seat.top,14),s.width=a.value.seat.width,s.height=a.value.seat.height,u.value=g.value;const y=X(()=>z(w.value)),I=X(()=>w.value),q=()=>{if(l.value<v.value)return;const c=l.value+1;v.value=c,t("changeLayer",c)},B=c=>{if(!f.value)return;let L=c.clientX-R.value,x=c.clientY-i.value;const P=0,J=10,Q=window.innerWidth-s.width,Z=window.innerHeight-s.height;s.left=Math.max(P,Math.min(Q,L)),s.top=Math.min(Z,Math.max(J,x))},M=c=>f.value=!1,E=c=>{if(d.value){d.value=!1,f.value=!1;return}if(c.altKey&&c.shiftKey)return t("del",r.value);if(f.value=!0,!b.value)return;const{left:L,top:x}=b.value.getBoundingClientRect();R.value=c.clientX-L,i.value=c.clientY-x,q()},H=(c,L)=>{let x=L==="view"?G(c):c;if(x=x.trim(),!f.value){if(!w.value&&!x&&!a.value.atomId)return t("del",r.value);w.value=x}},U=c=>{q()};return A(w,(c,L)=>{t("add",{content:I.value,extra:D(N({},!d.value&&s),{zIndex:v.value})},r.value)}),A(s,(c,L)=>{!a.value.atomId||d.value||t("add",{extra:D(N({},s),{zIndex:v.value})},r.value)},{deep:!0}),j(()=>{document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",M),document.addEventListener("mousemove",B),document.addEventListener("mouseup",M),b.value&&!a.value.atomId&&m.value.focus(),new ResizeObserver(L=>{let{width:x,height:P}=L[0].contentRect;s.width=x,s.height=P}).observe(m.value)}),()=>p("div",{class:{card:!0,fullScreen:d.value},ref:b,style:{left:s.left+"px",top:s.top+"px","z-index":v.value},onSelect:()=>!1},[p(je,{onMousefnc:E},{default:()=>[p("div",{class:"dragTitle"},[p("span",{onClick:c=>d.value=!d.value},null),p("span",{onClick:()=>u.value=!u.value},null)])]}),p("div",{ref:m,id:"contextRef"},[u.value?p(Be,{class:{fullScreen:d.value},content:y.value,"onUpdate:content":c=>y.value=c,viewSeat:s,onBlurfnc:H,onMousedown:U},null):p(ke,{class:{fullScreen:d.value},content:I.value,"onUpdate:content":c=>I.value=c,viewSeat:s,onMousedown:U,onBlurfnc:H},null)])])}},Ce={setup(o,{attrs:e,slots:n}){const t=V([]),l=de().appContext.config.globalProperties.$dbStore.getLib("atom"),g=h(null),f=h(0),d=h(!0),w=i=>{!(i.ctrlKey||i.altKey)||i.target===g.value&&(t.push({key:Math.random().toString(16),isNew:!0,seat:{left:i.pageX,top:i.pageY}}),d.value=i.altKey)},b=async i=>{l.update(i)},m=i=>{const u=t.splice(i,1);if(!u[0])return;const s=u[0].atomId;s&&b({target:".del",id:s})},v=async(i,u)=>{const s=t[u];if(!s)return;if(s.atomId)return b(D(N({},i),{id:s.atomId}));const y=await l.add(i);s.atomId=y},R=i=>{f.value=i};return A(t,(i,u)=>{f.value=Math.max(f.value,t.length)}),j(async()=>{await l.finish;const i=await l.getAll(),u=[];i.forEach(s=>{const y={key:Math.random().toString(16),atomId:s.id,seat:s.extra,zIndex:s.zIndex,content:s.content};s.target===".del"?u.push(y):t.push(y)})}),()=>p("div",{style:"width: calc(100vw); height: calc(100vh);",ref:g,onclick:w},[t.map((i,u)=>p(Oe,{key:i.key,itemInfo:i,itemIndex:u,layer:f.value,onDel:m,onAdd:v,viewModel:d,onChangeLayer:R},null))])}},qe=()=>p(Ce,null,null),Pe={setup(o,e){return()=>p("span",null,[ve("hello world")])}},Fe=fe({history:pe(),routes:[{path:"/Card",alias:"/",component:qe},{path:"/Recycle",component:Pe}]});const C=he(be);C.config.globalProperties.$axios=me;C.config.globalProperties.$dbStore=Ne;C.use(Fe);C.mount("#app");
